## vite-plugin-set-head-in-order

Плагин Vite, который упорядочивает элементы внутри `<head>` по правилам capo.js, сохраняя порядок элементов внутри каждой группы и нормализуя пробелы.

### Почему

- Правильный порядок элементов в `<head>` влияет на производительность и корректность загрузки ресурсов.
- Плагин реализует порядок групп согласно правилам capo.js: `meta`, `base`, `title`, подсказки соединений, скрипты и стили в нужной последовательности, разделённые по типам.

### Ссылка на правила capo.js

- Правила упорядочивания: [capo.js — User rules](https://rviscomi.github.io/capo.js/user/rules/)

### Установка

```bash
pnpm add -D @budarin/vite-plugin-set-head-in-order
# или
npm i -D @budarin/vite-plugin-set-head-in-order
# или
yarn add -D @budarin/vite-plugin-set-head-in-order
```

### Использование

```ts
// vite.config.ts
import { defineConfig } from 'vite';
import setHeadinOrderPlugin from '@budarin/vite-plugin-set-head-in-order';

export default defineConfig({
    plugins: [setHeadinOrderPlugin()],
});
```

### Что делает

- Обрабатывает только прямых потомков `head`.
- Классифицирует элементы по группам в порядке capo.js и пересобирает `head`, сохраняя исходный порядок элементов внутри каждой группы.

Ключевые моменты порядка:

- Синхронные скрипты (inline и простые внешние без async/defer/module) идут ДО любых preload.
- Синхронные стили (`link[rel="stylesheet"]`, `style`) стоят ПЕРЕД прелоадом стилей.
- Прелоад стилей — выше прелоада скриптов (`modulepreload`, `preload[as="script"]`).

### Порядок элементов в head (человеческим языком)

1. Базовые метаданные страницы: кодировка, служебные заголовки (http-equiv), настройки вьюпорта.
2. Базовый URL для ссылок (`<base>`), затем заголовок страницы (`<title>`).
3. Ранние настройки модулей: карта импортов (`importmap`).
4. Подсказки сети: установки соединения заранее (preconnect, dns-prefetch).
5. Синхронные скрипты: сначала инлайн-скрипты, затем обычные внешние скрипты без async/defer/module.
6. Синхронные стили: обычные таблицы стилей и блоки `<style>`.
7. Прелоады: сначала прелоад стилей, затем прелоад скриптов (включая modulepreload), затем прелоад остальных ресурсов.
8. Отложенные скрипты: сначала async и ES‑модули, потом defer.
9. Остальное: прочие мета‑теги, иконки/манифест/предвыборка (prefetch, prerender).

Порядок внутри каждой группы НЕ меняется.

### Лицензия

MIT
